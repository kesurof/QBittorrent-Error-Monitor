# QBittorrent Error Monitor

üöÄ **Monitor automatique des erreurs qBittorrent avec int√©gration Sonarr/Radarr**

[![GitHub Actions](https://github.com/kesurof/QBittorrent-Error-Monitor/actions/workflows/docker.yml/badge.svg)](https://github.com/kesurof/QBittorrent-Error-Monitor/actions)
[![GitHub Container Registry](https://ghcr.io/kesurof/qbittorrent-error-monitor/qbittorrent-monitor)](https://github.com/kesurof/QBittorrent-Error-Monitor/pkgs/container/qbittorrent-error-monitor%2Fqbittorrent-monitor)

## üéØ **Fonctionnalit√©s principales**

### üîç **Monitoring intelligent**
- **D√©tection automatique** des erreurs qBittorrent en temps r√©el
- **Surveillance continue** des logs et √©tats des torrents
- **Patterns d'erreur configurables** (timeout, DNS, tracker, ratio...)
- **Auto-d√©couverte** des conteneurs qBittorrent, Sonarr, Radarr

### üõ†Ô∏è **Actions automatiques**
- **Suppression intelligente** des t√©l√©chargements √©chou√©s
- **Blacklist automatique** pour √©viter les re-t√©l√©chargements
- **D√©clenchement imm√©diat** de nouvelles recherches Sonarr/Radarr
- **Notifications** optionnelles (logs d√©taill√©s)

### üê≥ **Int√©gration Docker**
- **Image pr√©-construite** sur GitHub Container Registry
- **Auto-configuration** compl√®te au d√©marrage
- **Permissions** PUID/PGID configurables
- **Health check** int√©gr√© (port 8080)
- **Multi-architecture** : AMD64, ARM64, ARM v7

### üìä **Monitoring et debug**
- **Logs structur√©s** avec niveaux configurables
- **M√©triques de performance** 
- **Mode test** et **dry-run** pour validation
- **Interface health check** pour supervision

## üê≥ **Image Docker**

```yaml
> üí° **Aucune construction locale n√©cessaire !** L'image est automatiquement disponible sur GitHub Container Registry.

## üìÅ **Installation**

### **üöÄ Installation rapide (recommand√©e)**

```bash
# Installation interactive avec choix du r√©seau
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install.sh | bash
```

### **‚öôÔ∏è Installation avanc√©e (configuration compl√®te)**

```bash
# Installation avec toutes les options (r√©seau, conteneurs, chemins)
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install-advanced.sh | bash
```

### **üîß Installation Docker Compose**

```bash
# Installation avec Docker Compose et fichier .env
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install-manual.sh | bash
```

### **üìã Choix du r√©seau Docker**

Lors de l'installation, vous pourrez choisir le r√©seau Docker :

- **bridge** (d√©faut Docker) - Pour usage basique
- **traefik_proxy** - Pour int√©gration Traefik 
- **docker_default** - Pour stack Docker Compose
- **Personnalis√©** - Votre r√©seau sp√©cifique

> üí° **Important** : Choisissez le m√™me r√©seau que vos conteneurs Sonarr/Radarr/qBittorrent pour qu'ils puissent communiquer.

### **‚öôÔ∏è Installation manuelle**

```bash
# Cr√©er les r√©pertoires
mkdir -p ~/qbittorrent-monitor/{config,logs}

# T√©l√©charger la configuration
curl -sSL -o ~/qbittorrent-monitor/config/config.yaml \
    https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/config/config.yaml

# D√©marrer le conteneur
docker run -d \
  --name qbittorrent-monitor \
  --restart unless-stopped \
  -e PUID=$(id -u) \
  -e PGID=$(id -g) \
  -e TZ=Europe/Paris \
  -v ~/qbittorrent-monitor/config:/app/config:rw \
  -v ~/qbittorrent-monitor/logs:/app/logs:rw \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  -p 8080:8080 \
  ghcr.io/kesurof/qbittorrent-error-monitor/qbittorrent-monitor:latest
```

## üîÑ **Flux simplifi√©**

```mermaid
graph LR
    A[Push Code] --> B[GitHub Actions]
    B --> C[Image GHCR]
    C --> D[Script install.sh]
    D --> E[Conteneur d√©marr√©]
```

1. **Push code** ‚Üí GitHub Actions build l'image
2. **Image disponible** sur GHCR  
3. **Utilisateur** ex√©cute le script d'installation
4. **Conteneur** d√©marr√© automatiquement
5. **Application** s'auto-configure au d√©marrage

## ‚öôÔ∏è **Configuration**

### **Variables d'environnement**

```bash
# Variables principales
PUID=1000                    # ID utilisateur
PGID=1000                    # ID groupe  
TZ=Europe/Paris              # Fuseau horaire

# Configuration application
CHECK_INTERVAL=300           # Intervalle v√©rification (sec)
LOG_LEVEL=INFO              # DEBUG|INFO|WARNING|ERROR
DRY_RUN=false               # Mode simulation
HTTP_PORT=8080              # Port health check
```

### **Personnalisation des patterns d'erreur**

```yaml
# √âditez config/config.yaml apr√®s le premier d√©marrage
error_patterns:
  connection_errors:
    - "Connection timed out"
    - "No such host is known"
    - "Name resolution failed"
  
  tracker_errors:
    - "Tracker error"
    - "Announce failed"
    - "Unregistered torrent"
  
  file_errors:
    - "No space left on device"
    - "Permission denied"
    - "Disk full"
```

## üìÇ **Structure des fichiers**

```bash
# Structure automatiquement cr√©√©e
~/qbittorrent-monitor/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml              # Configuration principal
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ qbittorrent-monitor.log  # Logs application
```

## üîß **Commandes utiles**

### **Monitoring en temps r√©el**

```bash
# Logs du conteneur
docker logs -f qbittorrent-monitor

# Logs de l'application
tail -f ~/qbittorrent-monitor/logs/qbittorrent-monitor.log

# Status du conteneur
docker ps | grep qbittorrent-monitor
```

### **Tests et debug**

```bash
# Test de configuration
docker exec qbittorrent-monitor python3 /app/qbittorrent-monitor.py --health-check

# Mode test (un cycle seulement)
docker exec qbittorrent-monitor python3 /app/qbittorrent-monitor.py --test

# Mode dry-run (simulation)
docker exec qbittorrent-monitor python3 /app/qbittorrent-monitor.py --dry-run --test
```

### **Gestion du service**

```bash
# Red√©marrage
docker restart qbittorrent-monitor

# Arr√™t
docker stop qbittorrent-monitor

# Suppression
docker rm qbittorrent-monitor

# V√©rification health check
curl -f http://localhost:8080/health || echo "Service KO"
```

## üîß **En cas de probl√®mes**

### **Erreur "exec: '/init': no such file or directory"**

Si vous rencontrez cette erreur, utilisez le script d'installation corrig√© :

```bash
# Script d'installation corrig√©
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install-fixed.sh | bash
```

### **Erreurs "ansible-playbook not found"**

Ces erreurs proviennent d'anciens scripts. Ignorez-les ou nettoyez votre installation :

```bash
# Nettoyer l'ancienne installation
docker stop qbittorrent-monitor 2>/dev/null || true
docker rm qbittorrent-monitor 2>/dev/null || true

# R√©installer proprement
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install-fixed.sh | bash
```

## üìÅ **Installation**

### **üöÄ Installation rapide (recommand√©e)**

```bash
# Installation en une commande
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install.sh | bash
```

### **üîß Installation Docker Compose**

```bash
# Installation avec Docker Compose
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install-manual.sh | bash
```

### **‚öôÔ∏è Installation manuelle**

```bash
# Cr√©er les r√©pertoires
mkdir -p ~/qbittorrent-monitor/{config,logs}

# T√©l√©charger la configuration
curl -sSL -o ~/qbittorrent-monitor/config/config.yaml \
    https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/config/config.yaml

# D√©marrer le conteneur
docker run -d \
  --name qbittorrent-monitor \
  --restart unless-stopped \
  -e PUID=$(id -u) \
  -e PGID=$(id -g) \
  -e TZ=Europe/Paris \
  -v ~/qbittorrent-monitor/config:/app/config:rw \
  -v ~/qbittorrent-monitor/logs:/app/logs:rw \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  -p 8080:8080 \
  ghcr.io/kesurof/qbittorrent-error-monitor/qbittorrent-monitor:latest
```

## üîÑ **Flux simplifi√©**

```mermaid
graph LR
    A[Push Code] --> B[GitHub Actions]
    B --> C[Image GHCR]
    C --> D[Script install.sh]
    D --> E[Conteneur d√©marr√©]
```

1. **Push code** ‚Üí GitHub Actions build l'image
2. **Image disponible** sur GHCR  
3. **Utilisateur** ex√©cute le script d'installation
4. **Conteneur** d√©marr√© automatiquement
5. **Application** s'auto-configure au d√©marrage

## ‚öôÔ∏è **Configuration**

### **Variables d'environnement**

```bash
# Variables principales
PUID=1000                    # ID utilisateur
PGID=1000                    # ID groupe  
TZ=Europe/Paris              # Fuseau horaire

# Configuration application
CHECK_INTERVAL=300           # Intervalle v√©rification (sec)
LOG_LEVEL=INFO              # DEBUG|INFO|WARNING|ERROR
DRY_RUN=false               # Mode simulation
HTTP_PORT=8080              # Port health check
```

### **Personnalisation des patterns d'erreur**

```yaml
# √âditez config/config.yaml apr√®s le premier d√©marrage
error_patterns:
  connection_errors:
    - "Connection timed out"
    - "No such host is known"
    - "Name resolution failed"
  
  tracker_errors:
    - "Tracker error"
    - "Announce failed"
    - "Unregistered torrent"
  
  file_errors:
    - "No space left on device"
    - "Permission denied"
    - "Disk full"
```

## üìÇ **Structure des fichiers**

```bash
# Structure automatiquement cr√©√©e
~/qbittorrent-monitor/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml              # Configuration principal
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ qbittorrent-monitor.log  # Logs application
```

## üîß **Commandes utiles**

### **Monitoring en temps r√©el**

```bash
# Logs du conteneur
docker logs -f qbittorrent-monitor

# Logs de l'application
tail -f ~/qbittorrent-monitor/logs/qbittorrent-monitor.log

# Status du conteneur
docker ps | grep qbittorrent-monitor
```

### **Tests et debug**

```bash
# Test de configuration
docker exec qbittorrent-monitor python3 /app/qbittorrent-monitor.py --health-check

# Mode test (un cycle seulement)
docker exec qbittorrent-monitor python3 /app/qbittorrent-monitor.py --test

# Mode dry-run (simulation)
docker exec qbittorrent-monitor python3 /app/qbittorrent-monitor.py --dry-run --test
```

### **Gestion du service**

```bash
# Red√©marrage
docker restart qbittorrent-monitor

# Arr√™t
docker stop qbittorrent-monitor

# Suppression
docker rm qbittorrent-monitor

# V√©rification health check
curl -f http://localhost:8080/health || echo "Service KO"
```

## üîß **En cas de probl√®mes**

### **Erreur "exec: '/init': no such file or directory"**

Si vous rencontrez cette erreur, utilisez le script d'installation corrig√© :

```bash
# Script d'installation corrig√©
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install-fixed.sh | bash
```

### **Erreurs "ansible-playbook not found"**

Ces erreurs proviennent d'anciens scripts. Ignorez-les ou nettoyez votre installation :

```bash
# Nettoyer l'ancienne installation
docker stop qbittorrent-monitor 2>/dev/null || true
docker rm qbittorrent-monitor 2>/dev/null || true

# R√©installer proprement
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install-fixed.sh | bash
```

## üìÅ **Installation**

### **üöÄ Installation rapide (recommand√©e)**

```bash
# Installation en une commande
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install.sh | bash
```

### **üîß Installation Docker Compose**

```bash
# Installation avec Docker Compose
curl -sSL https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/install-manual.sh | bash
```

### **‚öôÔ∏è Installation manuelle**

```bash
# Cr√©er les r√©pertoires
mkdir -p ~/qbittorrent-monitor/{config,logs}

# T√©l√©charger la configuration
curl -sSL -o ~/qbittorrent-monitor/config/config.yaml \
    https://raw.githubusercontent.com/kesurof/QBittorrent-Error-Monitor/main/config/config.yaml

# D√©marrer le conteneur
docker run -d \
  --name qbittorrent-monitor \
  --restart unless-stopped \
  -e PUID=$(id -u) \
  -e PGID=$(id -g) \
  -e TZ=Europe/Paris \
  -v ~/qbittorrent-monitor/config:/app/config:rw \
  -v ~/qbittorrent-monitor/logs:/app/logs:rw \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  -p 8080:8080 \
  ghcr.io/kesurof/qbittorrent-error-monitor/qbittorrent-monitor:latest
```

## üîÑ **Flux simplifi√©**

```mermaid
graph LR
    A[Push Code] --> B[GitHub Actions]
    B --> C[Image GHCR]
    C --> D[Script install.sh]
    D --> E[Conteneur d√©marr√©]
```

1. **Push code** ‚Üí GitHub Actions build l'image
2. **Image disponible** sur GHCR  
3. **Utilisateur** ex√©cute le script d'installation
4. **Conteneur** d√©marr√© automatiquement
5. **Application** s'auto-configure au d√©marrage

## ‚öôÔ∏è **Configuration**

### **Variables d'environnement**

```bash
# Variables principales
PUID=1000                    # ID utilisateur
PGID=1000                    # ID groupe  
TZ=Europe/Paris              # Fuseau horaire

# Configuration application
CHECK_INTERVAL=300           # Intervalle v√©rification (sec)
LOG_LEVEL=INFO              # DEBUG|INFO|WARNING|ERROR
DRY_RUN=false               # Mode simulation
HTTP_PORT=8080              # Port health check
```

### **Personnalisation des patterns d'erreur**

```yaml
# √âditez config/config.yaml apr√®s le premier d√©marrage
error_patterns:
  connection_errors:
    - "Connection timed out"
    - "No such host is known"
    - "Name resolution failed"
  
  tracker_errors:
    - "Tracker error"
    - "Announce failed"
    - "Unregistered torrent"
  
  file_errors:
    - "No space left on device"
    - "Permission denied"
    - "Disk full"
```

## üìÇ **Structure des fichiers**

```bash
# Structure automatiquement cr√©√©e
~/qbittorrent-monitor/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml              # Configuration principal
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ qbittorrent-monitor.log  # Logs application
```

## üîß **Commandes utiles**

### **Monitoring en temps r√©el**

```bash
# Logs du conteneur
docker logs -f qbittorrent-monitor

# Logs de l'application
tail -f ~/qbittorrent-monitor/logs/qbittorrent-monitor.log

# Status du conteneur
docker ps | grep qbittorrent-monitor
```

### **Tests et debug**

```bash
# Test de configuration
docker exec qbittorrent-monitor python3 /app/qbittorrent-monitor.py --health-check

# Mode test (un cycle seulement)
docker exec qbittorrent-monitor python3 /app/qbittorrent-monitor.py --test

# Mode dry-run (simulation)
docker exec qbittorrent-monitor python3 /app/qbittorrent-monitor.py --dry-run --test
```

### **Gestion du service**

```bash
# Red√©marrage
docker restart qbittorrent-monitor

# Arr√™t
docker stop qbittorrent-monitor

# Suppression
docker rm qbittorrent-monitor

# V√©rification health check
curl -f http://localhost:8080/health || echo "Service KO"
```

## üèóÔ∏è **Architecture & D√©veloppement**

### **üîÑ CI/CD Pipeline**
- **GitHub Actions** : Build automatique multi-architecture √† chaque push
- **GitHub Container Registry** : Stockage et distribution des images
- **Multi-arch** : Support AMD64, ARM64, ARM v7
- **Tags** : `latest`, version git SHA

### **üõ†Ô∏è Scripts et fichiers**

| Fichier | Usage | Description |
|---------|-------|-------------|
| `install.sh` | **‚úÖ RECOMMAND√â** | Installation rapide avec Docker |
| `install-manual.sh` | **üîß Docker Compose** | Installation avec docker-compose |
| `docker-compose.yml` | **üìÑ Compose** | Fichier compose pour installation manuelle |
| `deploy-ghcr.sh` | **üîß D√©veloppement** | Build manuel si GitHub Actions indisponible |
| `.github/workflows/docker.yml` | **ü§ñ CI/CD** | Pipeline automatique |

> **üí° Principe** : Image Docker pr√©-construite ‚Üí Script d'installation ‚Üí Auto-configuration

## üîó **Ressources et liens**

-  [qBittorrent WebUI API](https://github.com/qbittorrent/qBittorrent/wiki/WebUI-API)
- üì° [Sonarr API Documentation](https://sonarr.tv/docs/api/)
- üé¨ [Radarr API Documentation](https://radarr.video/docs/api/)
- üê≥ [GitHub Container Registry](https://github.com/kesurof/QBittorrent-Error-Monitor/pkgs/container/qbittorrent-error-monitor%2Fqbittorrent-monitor)

## üìÑ **Licence**

MIT License - Voir le fichier [LICENSE](LICENSE)

---

**üéØ Solution Docker simple et efficace ‚Ä¢ üê≥ Image pr√©-construite ‚Ä¢ ü§ñ CI/CD GitHub Actions**
